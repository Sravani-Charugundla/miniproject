<html>
  <head>
    <title>Buyer</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  <body onload="connectMetamask();connectContract();">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <a class="navbar-brand" href="#"><h1>Buyer</h1></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <!-- <li class="nav-item active">
            <a class="nav-link" href="vendor.html"><h3>Vendor1</h3><span class="sr-only"></span></a>
          </li> -->
          <li class="nav-item active">
            <a class="nav-link" href="ordersplaced.html"><h4>OpenRequests</h4><span class="sr-only"></span></a>
          </li>
		  <li class="nav-item active">
            <a class="nav-link" href="acceptedorders.html"><h4>AcceptedQuotes</h4><span class="sr-only"></span></a>
          </li>
		  <li class="nav-item active">
            <a class="nav-link" href="index.html"><h4>Home</h4><span class="sr-only"></span></a>
          </li>
        </ul>
      </div>
    </nav>
	<div class="container">
		<div class="row">
			<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRfmdw4X0yThXcSwqgTPxyfMc1orQP1l2-n9Q&usqp=CAU" width="40%" height="280px">
		</div>
	<h1 style="text-align: center;">
        SUPPLY REQUEST FORM
    </h1>
    
    
  <!-- <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br> -->
	<p id="accountArea" style="text-align: end;">Connection Status: NOT CONNECTED to Metamask </p>

	<!-- <button onclick="connectContract()">CONNECT TO CONTRACT</button> <br> -->
	<p id="contractArea" style="text-align: end;">Connection Status: NOT CONNECTED to Smart Contract</p>


	<!-- <button onclick="changeWord()">CHANGE DATA ON THE SMART CONTRACT</button> <br>
    <input type="text" id="inputArea">  -->

    <script>
        let account;
        const connectMetamask = async () => {
            if(window.ethereum !== "undefined"){
                const accounts = await ethereum.request({method: "eth_requestAccounts"});
                account = accounts[0];
                document.getElementById("accountArea").innerHTML = `Account is: ${account}`;
            }

        }

        const connectContract = async () => {
            const ABI =[
	{
		"inputs": [
			{
				"internalType": "string[][]",
				"name": "d",
				"type": "string[][]"
			}
		],
		"name": "acptorders",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "a",
				"type": "uint256"
			}
		],
		"name": "addprice",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[][]",
				"name": "b",
				"type": "string[][]"
			}
		],
		"name": "orders",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[][]",
				"name": "a",
				"type": "string[][]"
			}
		],
		"name": "save",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "acpt_displayord",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "acptord",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "arr",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "cacptord",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "cvendors",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "display1DArray",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "displayord",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_acpt_ord",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_ord",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_pairs",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_req",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "key_val_pairs",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "showprice",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "vendors",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
            const Address = "0xaea00aFDB998A79C3E565E12EB5e4502B0D53e33";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);
            document.getElementById("contractArea").innerHTML = "Contract Connection Status: Success";
        }

        // const readWord = async () => {
        //     const data = await window.contract.methods.getFlower().call();
        //     document.getElementById("dataArea").innerHTML = `Word is: ${data}`;
        // }

        const changeWord = async () => {
            // const myEntry = document.getElementById("inputArea").value;
            if(n==0)
            {
            await window.contract.methods.save(data).send({ from: account });
            n+=1;
            }
            else{
              alert("You can't add items now!");
            }

        }
    </script>
    <div style="text-align: right;">
	
    <button id="Add" class="btn btn-primary">Click to Add Items</button>
	<br>
	
	<h3 style="text-align: center;">Supplies           -Quantity</h3>

    </div>
    <!-- <button id="Remove">Click to remove textbox</button> -->
    <!-- <button id="see" class="btn btn-warning">ADD TO CART</button> -->
    <div id="textboxDiv"></div>
    <script>
      var n = 0;
      var data = []; // initialize 2D array
      let i=0;
      $(document).ready(function () {
        $('#Add').on('click', function () {
          
          $('#textboxDiv').append(
            `<div class="wrapper" style="text-align: center;"><span class="inline"><input type="text" id="${i}" placeholder="Item"/><input type="number" id="${i}1" placeholder="Quantity"/></span></div>`
          );
          i++;
        });
        $('#Remove').on('click', function () {
          data.pop(); // remove last element from 2D array
          $('#textboxDiv').children().last().remove();
        });
		
        $('#see').on('click',function(){
          if(n==0)
          {
			var ordid4=localStorage.getItem("counter4")||0;
			var sord = ordid4.toString();
          for(let j=0;j<i;j++){ 
                    textValue = document.getElementById(`${j}`).value; // get text input value
                    numValue =  document.getElementById(`${j}1`).value;  // get number input value
                    var newData = [textValue, numValue,sord]; // create new data array
                    data.push(newData); // add new data array to 2D array
                    console.log(data);
            }
			ordid4++;
		  	localStorage.setItem("counter4",ordid4);
          }
          else{
            alert("Place Request");
          }
		  
        })
      });
    </script>
    <br>
    <div style="text-align: center;">
    <button id="see" class="btn btn-warning" onclick="showConfirm()">ADD SUPPLIES</button>
	<br>
    <script>
      function showConfirm() {
  const result = alert("Place the request");
//   if (result) {
//     // User clicked "OK" or "Yes"
//     alert("You clicked OK.");
//   } else {
//     // User clicked "Cancel" or "No"
//     alert("You clicked Cancel.");
//   }
}
      </script>
    
    <br>
    <button onclick="changeWord()" class="btn btn-success">PLACE REQUEST</button> <br>
</div>
    
    <!-- <input type="text" id="inputArea">  -->
    <!-- <button onclick="readContract()" class="btn btn-primary">Check Requests</button> -->
    <!-- <table id="myTable" class="table table-striped">
      <thead>
        <tr>
          <th><h3>Vendor</h3></th>
          <th><h3>Quotation</h3></th>
          <th><h3>Accept/Decline</h3></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Vendor1</td>
          <td>
            <p id="dataArea"></p>
          </td>
          <td>
            <button type="button" class="btn btn-success">Accept</button>
          </td>
        </tr>
        <tr>
          <td>Vendor2</td>
          <td>30</td>
          <td>
            <button type="button" class="btn btn-success">Accept</button>
          </td>
        </tr>
      </tbody>
    </table>
    <script>
      function displayTable() {
        var table = document.getElementById("myTable");
        table.style.display = "table";
      }
      const readContract = async () => {
            var table = document.getElementById("myTable");
            table.style.display = "table";
            const da = await window.contract.methods.showprice().call();
            document.getElementById("dataArea").innerHTML = da[da.length-1];
        }
    </script> -->
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  </body>
</html>
